machine:
    node:
        version: 6.10.0

dependencies:
    pre:
        - echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" >> ~/.npmrc
    override:
        - npm install

test:
    override:
        - npm run coverage
    post:
        - mkdir $CIRCLE_ARTIFACTS/coverage
        - mv ./coverage $CIRCLE_ARTIFACTS

deployment:
    production:
        # git tags get deployed to npm
        tag: /[0-9]+(\.[0-9]+)*/
        owner: astronomerio
        commands: 
            - npm version $CIRCLE_TAG
            - npm publish
